{% extends "base.html" %}
{% load static %}

{% block title %}ACCESS Active Resources | Operations{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    ACCESS Active Resources
</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {# Resource Actions Header #}
    <div class="resource-actions-header mb-4">
        <div class="d-flex flex-column flex-md-row align-items-md-center gap-3">
            <div class="flex-shrink-0">
                <strong class="fs-5">Resource Actions</strong>
            </div>
            <div class="d-flex flex-wrap gap-2">
                <a class="btn btn-access-primary" href="https://allocations.access-ci.org/" target="_blank">Request Allocations</a>
                <a class="btn btn-access-primary" href="https://access-ci.atlassian.net/wiki/spaces/ACCESSdocumentation/overview" target="_blank">View Documentation</a>
                <a class="btn btn-access-primary" href="https://support.access-ci.org/events" target="_blank">Related Training</a>
                <a class="btn btn-access-primary" href="https://metrics.access-ci.org/" target="_blank">Related Metrics</a>
            </div>
        </div>
    </div>

    {% if error_message %}
    <div class="alert alert-warning" role="alert">
        <i class="bi bi-exclamation-triangle"></i> {{ error_message }}
    </div>
    {% endif %}

    {# Resources organized by organization #}
    {% for org_name, resources in resources_by_org.items %}
    <div class="organization-section mb-4">
        {# Organization Header - Always Visible #}
        <h3 class="organization-header"><strong>{{ org_name }}</strong></h3>
        
        {# Resources Accordion for this Organization #}
        <div class="accordion accordion-flush" id="accordion-org-{{ forloop.counter }}">
            {% for resource in resources %}
            <div class="accordion-item">
                <h4 class="accordion-header" id="heading-{{ forloop.parentloop.counter }}-{{ forloop.counter }}">
                    <button class="accordion-button collapsed" type="button" 
                            data-bs-toggle="collapse" data-bs-target="#collapse-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" 
                            aria-expanded="false" aria-controls="collapse-{{ forloop.parentloop.counter }}-{{ forloop.counter }}">
                        {{ resource.resource_descriptive_name|default:"Resource" }}
                    </button>
                </h4>
                <div id="collapse-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" 
                     class="accordion-collapse collapse" 
                     aria-labelledby="heading-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" 
                     data-bs-parent="#accordion-org-{{ forloop.parentloop.counter }}">
                    <div class="accordion-body">
                        {% if resource.resource_description %}
                        <div class="resource-description mb-3">
                            <h5 class="description-label">Description</h5>
                            <div class="description-content">
                                {{ resource.resource_description|safe }}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if resource.info_resourceid %}
                        <div class="mt-3">
                            <a class="btn btn-link resource-link" href="https://operations.access-ci.org/node/{{ resource.info_resourceid }}" target="_blank">
                                {{ resource.resource_descriptive_name|default:"View Resource" }}
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% empty %}
    <div class="alert alert-info" role="alert">
        <i class="bi bi-info-circle"></i> No resources available at this time.
    </div>
    {% endfor %}
</div>
{% endblock %}
